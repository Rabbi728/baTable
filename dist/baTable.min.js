/*!
 * baTable Version v1.1 (https://github.com/Rabbi728/baTable)
 *
 * Author By Rabbi Ahamed
 * Email : RabbiAhamed0728@gmail.com 
 *
 * (Bootstrap and proper) Or (Bootstrap.Bundle) Is Required For Use This Plugin
 */
!function($){$(document).ready((function(){function select_filter(index){let data=el.find(`tbody tr td:nth-child(${index})`),unique_data=[];for(let i=0;i<data.length;i++)unique_data[$(data[i]).text()]=$(data[i]).text();let select=`<select class="form-control form-control-sm baTable-search" data-col="${index-1}">`;select+='<option value="">-- Choose --</option>';for(const key in unique_data)select+=`<option value="${unique_data[key]}">${unique_data[key]}</option>`;return select+="</select>",select}function sorting(){let index=$(this).index(),trs=el.find("tbody tr"),sort_attr=$(this).attr("sort");null==sort_attr||"asc"==sort_attr?(trs.sort((function(a,b){let a_val=$(a).find(`td:nth-child(${index+1})`).text(),b_val=$(b).find(`td:nth-child(${index+1})`).text();return a_val<b_val?-1:a_val>b_val?1:0})),$(this).attr("sort","desc")):"desc"==sort_attr&&(trs.sort((function(a,b){let a_val=$(a).find(`td:nth-child(${index+1})`).text(),b_val=$(b).find(`td:nth-child(${index+1})`).text();return a_val<b_val?1:a_val>b_val?-1:0})),$(this).attr("sort","asc")),el.find("tbody").html(trs)}function ba_table_search(){let search_area=el.find("tbody tr"),columns=[];if($.each($(".baTable-search"),(function(i,v){if($(v).val().length>0){let data={};data.col_index=$(v).data("col"),data.col_value=$(v).val(),columns.push(data)}})),$.each(search_area,(function(index,row){$(row).removeClass("d-none"),$.each(columns,(function(input_index,input_value){let el=$(row).find("td").get(input_value.col_index),el_result;-1==$(el).text().toLowerCase().indexOf(input_value.col_value.toLowerCase())&&$(row).addClass("d-none")}))})),search_area.length==el.find("tbody tr.d-none").length){let not_found_html='\n                                    <tr class="not-fount-tr" style="width: 100%; display: flex;">\n                                        <th class="w-100">\n                                            <h4 class="text-center w-100">\n                                                Data Not Found !\n                                            </h4>\n                                        </th>\n                                    </tr>\n                                   ';el.find("tbody").append(not_found_html)}else $(".not-fount-tr").remove();let thead=el.find("thead tr:nth-child(2) th");for(let input=0;input<thead.length;input++)el.find(`tfoot tr td:nth-child(${input+1})`).text(summary_decision(thead[input],input+1))}function select_cols(){let el=$(this),indx=parseInt(el.data("col-index"))+1,chk=this.checked,colspan=parseInt($("table:first>thead>tr:first-child>th:first-child").attr("colspan"));chk?($("table>thead>tr:first-child>th:first-child").attr("colspan",++colspan),$(`table>thead>tr:nth-child(2)>th:nth-child(${indx}), table>thead>tr:nth-child(3)>th:nth-child(${indx}), table>tfoot>tr>td:nth-child(${indx}), table>tbody>tr>td:nth-child(${indx})`).removeClass("d-none")):($("table>thead>tr:first-child>th:first-child").attr("colspan",--colspan),$(`table>thead>tr:nth-child(2)>th:nth-child(${indx}), table>thead>tr:nth-child(3)>th:nth-child(${indx}), table>tfoot>tr>td:nth-child(${indx}) , table>tbody>tr>td:nth-child(${indx})`).addClass("d-none"))}function generate_col_checkboxes(){let cols=$("table:first>thead>tr:nth-child(2)>th"),html="";$.each(cols,(function(i,v){let col=$(v),indx=col.index(),chk=col.hasClass("d-none")?"":"checked",lock=col.hasClass("required")?"disabled":"";html+=`\n                <div class="form-group form-check m-0 ml-2">\n                    <input type="checkbox" class="form-check-input tbl-head" id="checkbox-${indx}" data-col-index="${i}" ${chk} ${lock}>\n                    <label class="form-check-label" for="checkbox-${indx}">${col.text()} &nbsp;<span class="text-muted">${col.prop("title")}</span></label>\n                </div>\n            `}));let offset_top=$("#baTable-mainArea .baTable-option").offset().top,offset_left=$("#baTable-mainArea .baTable-option").offset().left;$("#baTable-mainArea").find(".baTable-optionbar").css({top:offset_top+20,left:offset_left+10}),$("#baTable-mainArea").find(".baTable-optionbar").html(html).removeClass("d-none")}function get_timestamp(format=null){let ts={},xDateObj=new Date,xYear=xDateObj.getFullYear(),xMonth=xDateObj.getMonth()+1,xDate=xDateObj.getDate(),xHour=xDateObj.getHours(),xMin=xDateObj.getMinutes(),xSec=xDateObj.getSeconds();return xMonth<10&&(xMonth="0"+xMonth),xDate<10&&(xDate="0"+xDate),xHour<10&&(xHour="0"+xHour),xMin<10&&(xMin="0"+xMin),xSec<10&&(xSec="0"+xSec),ts.mysql=xYear+"-"+xMonth+"-"+xDate+" "+xHour+":"+xMin+":"+xSec,ts.file=xYear+"-"+xMonth+"-"+xDate+"_"+xHour+"-"+xMin+"-"+xSec,"mysql"==format?ts.mysql:"file"==format?ts.file:ts}function summary_decision(thead,index){let summarytype=$(thead).attr("summarytype");return"count"==summarytype?total_count(index):"unique-count"==summarytype?unique_count(index):"sum"==summarytype?sum(index):""}function total_count(index){let el_not_d_none;return el.find("tbody tr").not(".d-none").find(`td:nth-child(${index})`).length}function unique_count(index){let el_not_d_none,data=el.find("tbody tr").not(".d-none").find(`td:nth-child(${index})`),unique_data=[];for(let i=0;i<data.length;i++)unique_data[$(data[i]).text()]=$(data[i]).text();return`[ ${Object.keys(unique_data).length} ]`}function sum(index){let el_not_d_none,data=el.find("tbody tr").not(".d-none").find(`td:nth-child(${index})`),sum=0;for(let i=0;i<data.length;i++)sum+=parseFloat($(data[i]).text());return sum.toLocaleString()}$.fn.baTable=function(param){el=$(this),el.parent(".container").length>0?el.parent(".container").html(`<div id="baTable-mainArea">${el.parent().html()}</div>`):el.parent(".container-fluid").length>0?el.parent(".container-fluid").html(`<div id="baTable-mainArea">${el.parent().html()}</div>`):alert("The parent class of this table is not a container of any kind"),el=$("#baTable-mainArea").find("table");let optionbar='<div class="baTable-optionbar p-2 d-none">\n                            </div>';$("#baTable-mainArea").append(optionbar),null!=param.data&&null!=param.keys&&$.each(param.data,(function(i,v){let tr="<tr>";$.each(param.keys,(function(i2,v2){tr+=`<td>${v[v2]}</td>`})),tr+="</tr>",el.find("tbody").append(tr)}));let thead=el.find("thead th"),pre_def_count=0,pre_def_size=0,thead_bg=el.find("thead").attr("bg"),thead_text=el.find("thead").attr("text"),tfoot_bg=el.find("tfoot").attr("bg"),tfoot_text=el.find("tfoot").attr("text"),input_tr="";tfoot_tr="",el.addClass("table table-sm table-bordered table-hover"),$.each(el.find("thead th[width]"),(function(i,v){pre_def_count++,pre_def_size+=parseInt($(v).attr("width"))}));let col_size=(100-pre_def_size)/(thead.length-pre_def_count);el.find("thead th").not("[width]").attr("width",`${col_size}%`),el.find("thead").prepend(`<tr width="100%" style="background: #fff; font-size: 10px; color : #000;">\n                                <th width="100%">\n                                    <span class="baTable-option float-left mr-2"></span><big class="float-left">${param.title}</big> <big class="float-right">DATE : ${get_timestamp("mysql")}</big>\n                                </th>\n                            </tr>`),null==thead_bg?el.find("thead").addClass("bg-dark text-white text-center"):el.find("thead").addClass(`${thead_bg} ${thead_text} text-center`),null==tfoot_bg?el.find("tfoot").addClass("bg-dark text-white text-center"):el.find("tfoot").addClass(`${tfoot_bg} ${tfoot_text} text-center`),input_tr+="<tr>",tfoot_tr+="<tr>";for(let input=0;input<thead.length;input++){$(thead[input]).addClass("baTable-head");let field="";this_col_size=$(thead[input]).attr("width"),"true"==$(thead[input]).attr("filter")?field=`<input type="text" data-col="${input}" class="form-control form-control-sm baTable-search">`:"select"==$(thead[input]).attr("filter")&&(field=select_filter(input+1)),input_tr+=`<th width="${this_col_size}">${field}</th>`,$(el.find(`tbody tr td:nth-child(${input+1})`)).attr("width",this_col_size),tfoot_tr+=`<td width="${this_col_size}">${summary_decision(thead[input],input+1)}</td>`}tfoot_tr+="</tr>",input_tr+="</tr>",el.find("thead").append(input_tr),el.find("tfoot").html(tfoot_tr),el.find("thead, tbody, tfoot").css({display:"block","overflow-y":"scroll"}),el.find("tr").css({width:"100%",display:"flex"}),el.find("th, td").css({"flex-grow":"2"}),el.find("tbody").css({"max-height":"60vh"}),$(document).on("keyup",".baTable-search",ba_table_search),$(document).on("change",".baTable-search",ba_table_search),$(document).on("click",".baTable-option",generate_col_checkboxes),$(document).on("click",".form-check-input.tbl-head",select_cols),$(document).on("click",".baTable-head",sorting),$("body").click((function(event){0==$(event.target).parent("#baTable-mainArea .baTable-optionbar, #baTable-mainArea .baTable-optionbar .form-group").length&&$(".baTable-optionbar").addClass("d-none")}))}}))}(jQuery);